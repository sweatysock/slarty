const SampleRate=16e3,PerfSampleRate=32e3,PacketSize=500,PerfPacketSize=PacketSize*PerfSampleRate/16000,HighFilterFreq=16000/2.2,LowFilterFreq=200,ChunkSize=1024;var soundcardSampleRate=null,micAudioPacketSize=0,socketConnected=!1,micAccessAllowed=!1,packetBuf=[],spkrBufferL=[],spkrBufferR=[],venueBuffer=[],maxBuffSize=2e4,micBufferL=[],micBufferR=[],myChannel=-1,myName="",myGroup="noGroup",groupLayout=[8,12,4,10,6,9,7,11,5,13,3,14,2,15,1,16,0,4,10,6,9],pans=[-9,-5,-3,-2.4,-2,-1.7,-1.4,-1.2,1,1.2,1.4,1.7,2,2.4,3,5,7],groupCentre=8,maxGroupSize=17,myPos=0,performer=!1,loopback=!1,stereoOn=!0,HQOn=!0;const NumberOfChannels=20;var channels=[];for(let e=0;e<NumberOfChannels;e++)channels[e]={name:"",gain:1,agc:!0,muted:!1,peak:0,channel:e,seq:0,buffer8:[],buffer16:[]};var liveShow=!1,serverLiveChannels=[],mixOut={name:"Output",gain:0,gainRate:100,targetGain:1,ceiling:1,agc:!0,muted:!1,peak:0,channel:"mixOut"},micIn={name:"Mic",gain:0,gainRate:100,targetGain:1,ceiling:1,agc:!0,muted:!1,peak:0,channel:"micIn",threshold:0,gate:1},venue={name:"Venue",gain:0,gainRate:100,targetGain:1,ceiling:1,agc:!0,muted:!1,peak:0,channel:"venue"},recording=!1,serverMuted=!1,venueSize=1,venueSizeCmd=0,audience=1,rtt=0,rtt1=0,rtt5=0;function processCommands(e){if(serverMuted=null!=e.mute&&e.mute,null!=e.gateDelay&&(gateDelay=e.gateDelay),null!=e.venueSize&&(venueSizeCmd=e.venueSize),null!=e.perfLevel&&performer&&(micIn.gain=e.perfLevel,micIn.agc=!1),null!=e.noiseThreshold&&(noiseThreshold=e.noiseThreshold),null!=e.displayURL);if(null!=e.displayText);}var socketIO=io();socketIO.on("connect",function(){trace("socket connected!"),socketIO.emit("upstreamHi",{channel:myChannel})}),socketIO.on("channel",function(e){if(0<e.channel){myChannel=e.channel,""==myName&&(myName="Input "+myChannel),micIn.name="Mic ("+myChannel+")";let t=document.getElementById("ID"+micIn.channel+"Name");null!=t&&(t.innerHTML=micIn.name),trace("Channel assigned: ",myChannel),socketConnected=!0,e.loopback?(loopback=!0,performer=!0,document.getElementById("onair").style.visibility="visible",micFilter1.frequency.value=PerfSampleRate/2.2,micFilter2.frequency.value=30):loadVenueReverb(e.reverb)}else trace("Server unable to assign a channel"),trace("Try a different server"),socketConnected=!1}),socketIO.on("perf",function(e){performer=e.live,!0==performer?(document.getElementById("onair").style.visibility="visible",micFilter1.frequency.value=PerfSampleRate/2.2,micFilter2.frequency.value=30):(document.getElementById("onair").style.visibility="hidden",micFilter1.frequency.value=HighFilterFreq,micFilter2.frequency.value=LowFilterFreq)}),socketIO.on("d",function(e){enterState(dataInState),packetsIn++;let t=JSON.stringify(e).length/1024;if(bytesRcvd+=t,serverLiveChannels=e.liveChannels,processCommands(e.commands),micAccessAllowed){let t=[],n=Array(PacketSize/2).fill(0),o=Array(PacketSize/2).fill(0),l=[],a=[],s=!1,d=Array(PacketSize/2).fill(0),r=Array(PacketSize/2).fill(0),h=Array(PacketSize/2).fill(0),u=Array(PacketSize/2).fill(0),m=!1,y=serverLiveChannels[myChannel],f=groupLayout[y];if(e.channels.forEach(e=>{let t=e.channel,i=channels[t];if(0!=t){i.name=e.name,i.channel=t,i.peak<e.peak&&(i.peak=e.peak);let s=e.audio;if(!i.muted){let e=s.mono8,a=s.mono16,y=i.buffer8,v=i.buffer16,b=i.agc?mixOut.gain:i.gain;i.gain=b;let g=serverLiveChannels[t],k=groupLayout[g];k=(k+(groupCentre-f))%maxGroupSize;let l=pans[k];if(0<e.length){m=!0;let t=0,o=0;if(0>l){o=-1*l;for(let t=0;t<e.length;t++)d[t]+=e[t]*b,n[t]+=e[t],h[t]+=e[t]*b/o}else{t=l;for(let o=0;o<e.length;o++)h[o]+=e[o]*b,n[o]+=e[o],d[o]+=e[o]*b/t}}if(0<a.length){let e=0,t=0;if(0>l){t=-1*l;for(let e=0;e<a.length;e++)r[e]+=a[e]*b,o[e]+=a[e],u[e]+=a[e]*b/t}else{e=l;for(let t=0;t<a.length;t++)u[t]+=a[t]*b,o[t]+=a[t],r[t]+=a[t]*b/e}}}}e.sequence!=i.seq+1&&trace("Sequence jump Channel ",t," jump ",e.sequence-i.seq),i.seq=e.sequence}),m){let e=0;for(let t=0;t<d.length;t++)l[e]=d[t]+r[t],a[e]=h[t]+u[t],e++,l[e]=d[t]-r[t],a[e]=h[t]-u[t],e++;l=reSample(l,SampleRate,soundcardSampleRate,gLCache,micAudioPacketSize),a=reSample(a,SampleRate,soundcardSampleRate,gRCache,micAudioPacketSize),s=!0}let v=[],b=[];if(0<l.length)v=l,b=a;else{let e=Math.round(micAudioPacketSize);v=Array(e).fill(0),b=Array(e).fill(0)}let k=0,g=e.venue;if(null!=g){venue.gain=venue.agc?mixOut.gain:venue.gain,k=g.timestamps[myChannel],audience=g.liveClients,venueSize=0==venueSizeCmd?audience:venueSizeCmd;let e=[],l=[],a=g.seqNos[myChannel];if(null!=a)for(;packetBuf.length;){let t=packetBuf.shift();if(t.sequence==a){e=t.audio.mono8,l=t.audio.mono16;break}}let i=zipson.parse(g.audio),s=i.mono8,d=i.mono16;if(0<s.length&&!venue.muted){let i=8e3;if(0<e.length&&0<n.length)for(let t=0;t<e.length;++t)s[t]=(s[t]-e[t]-n[t])*venue.gain/venueSize;if(0<e.length&&0==n.length)for(let t=0;t<e.length;++t)s[t]=(s[t]-e[t])*venue.gain/venueSize;if(0==e.length&&0<n.length)for(let e=0;e<n.length;++e)s[e]=(s[e]-n[e])*venue.gain/venueSize;if(0<d.length){if(0<l.length&&0<o.length)for(let e=0;e<l.length;++e)d[e]=(d[e]-l[e]-o[e])*venue.gain/venueSize;if(0<l.length&&0==o.length)for(let e=0;e<l.length;++e)d[e]=(d[e]-l[e])*venue.gain/venueSize;if(0==l.length&&0<o.length)for(let e=0;e<o.length;++e)d[e]=(d[e]-o[e])*venue.gain/venueSize;let e=0;for(let n=0;n<s.length;n++)t[e]=s[n]+d[n],e++,t[e]=s[n]-d[n],e++;i=16e3}else t=s;let a=maxValue(t);a>venue.peak&&(venue.peak=a),t=reSample(t,i,soundcardSampleRate,vCache,micAudioPacketSize)}else venue.peak=0}if(performer=e.perf.chan==myChannel,liveShow=e.perf.live,e.perf.live&&null!=e.perf.packet&&!1!=e.perf.packet.perfAudio){let t=zipson.parse(e.perf.packet.perfAudio),n=t.mono8,o=t.mono16,l=t.mono32;if(!performer||loopback){let e=[],a=[],r=0,g=0,i=32e3;if(0==n.length){Array(250).fill(0);i=8e3}else if(0==o.length)e=n,i=8e3;else if(0==l.length){for(let t=0;t<n.length;t++)e[g]=n[t]+o[t],g++,e[g]=n[t]-o[t],g++;i=16e3}else for(let t=0;t<n.length;t++){let i=n[t]+o[t],a=n[t]-o[t];e[g]=i+l[r],g++,e[g]=i-l[r],r++,g++,e[g]=a+l[r],g++,e[g]=a-l[r],r++,g++}e=reSample(e,i,soundcardSampleRate,upCachePerfM,micAudioPacketSize);let h=t.stereo8,u=t.stereo16,m=t.stereo32;if(0<h.length){if(s=!0,r=0,g=0,0==u.length)a=h,i=8e3;else if(0==m.length){for(let e=0;e<h.length;e++)a[g]=h[e]+u[e],g++,a[g]=h[e]-u[e],g++;i=16e3}else for(let e=0;e<h.length;e++){let t=h[e]+u[e],i=h[e]-u[e];a[g]=t+m[r],g++,a[g]=t-m[r],r++,g++,a[g]=i+m[r],g++,a[g]=i-m[r],r++,g++}a=reSample(a,i,soundcardSampleRate,upCachePerfS,micAudioPacketSize);let t=[],n=[];for(let o=0;o<e.length;o++)t[o]=(e[o]+a[o])/2,n[o]=(e[o]-a[o])/2;if(0==v.length)v=t,b=n;else for(let e=0;e<t.length;e++)v[e]+=t[e],b[e]+=n[e]}else if(0==v.length)v=e,b=e;else{s=!0;for(let t=0;t<e.length;t++)v[t]+=e[t],b[t]+=e[t]}}else k=e.perf.packet.timestamp;loopback&&(k=e.perf.packet.timestamp)}var i;if(s){let e=maxValue(v),t=maxValue(b);e>t?(i=applyAutoGain(v,mixOut),applyGain(b,i.finalGain)):(i=applyAutoGain(b,mixOut),applyGain(v,i.finalGain))}else i=applyAutoGain(v,mixOut);if(mixOut.gain=i.finalGain,i.peak+=venue.peak,i.peak>mixOut.peak&&(mixOut.peak=i.peak),spkrBufferL.push(...v),s?spkrBufferR.push(...b):spkrBufferR.push(...v),spkrBufferL.length>maxBuffSize&&(spkrBufferL.splice(0,spkrBufferL.length-maxBuffSize),spkrBufferR.splice(0,spkrBufferR.length-maxBuffSize),overflows++),0<t.length&&venueBuffer.push(...t),venueBuffer.length>maxBuffSize&&venueBuffer.splice(0,venueBuffer.length-maxBuffSize),0<k){let e=new Date().getTime();rtt=e-k,rtt1=0==rtt1?rtt:(9*rtt1+rtt)/10,rtt5=(49*rtt5+rtt)/50}}enterState(idleState)}),socketIO.on("disconnect",function(){trace("socket disconnected!"),socketConnected=!1});var lastReset=new Date().getTime();function resetConnection(){let e=new Date().getTime();lastReset+6e4<e&&(trace2("Socket resetting..."),socketIO.disconnect(),socketIO.connect(),lastReset=e)}var displayRefresh=100;document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("groupBtn"),t=document.getElementById("groupNameEntry");e.onclick=()=>{t.innerHTML="",t.style.visibility="visible",t.style.outline="none",t.setAttribute("contenteditable",!0),t.focus()},t.addEventListener("keydown",i=>{13===i.which&&(""==t.innerHTML?(t.setAttribute("contenteditable",!1),myGroup="noGroup"):t.innerHTML.match("^[a-zA-Z][a-zA-Z0-9]+$")&&(t.setAttribute("contenteditable",!1),myGroup=t.innerHTML),i.preventDefault())});let i=document.getElementById("posBtn"),n=document.getElementById("posEntry");i.onclick=()=>{posEntry.innerHTML="0",posEntry.style.visibility="visible",posEntry.style.outline="none",posEntry.setAttribute("contenteditable",!0),posEntry.focus()},posEntry.addEventListener("keydown",t=>{13===t.which&&(myPos=""==posEntry.innerHTML?0:parseFloat(posEntry.innerHTML),t.preventDefault())})});function displayAnimation(){enterState(UIState);const e=.8;if(micAccessAllowed)for(let t in mixOut.peak*=e,setLevelDisplay(mixOut),setSliderPos(mixOut),micIn.peak*=e,setLevelDisplay(micIn),setSliderPos(micIn),loopback||setThresholdPos(micIn),venue.peak*=e,setLevelDisplay(venue),setSliderPos(venue),channels)c=channels[t],""!=c.name&&(null==serverLiveChannels[t]?removeChannelUI(c):(null==c.displayID&&createChannelUI(c),c.peak*=e,setLevelDisplay(c),setSliderPos(c)));1e3>=displayRefresh&&setTimeout(displayAnimation,displayRefresh),enterState(idleState)}function toggleSettings(){let e=document.getElementById("mixerViewer");"hidden"==e.style.visibility?(e.style.visibility="visible",displayRefresh=100,setTimeout(displayAnimation,displayRefresh)):(e.style.visibility="hidden",displayRefresh=2e3)}function mapToLevelDisplay(e){let t=0;return .01<e&&(t=65*(10.5*Math.log10(e)+21)/21),t}function setLevelDisplay(e){let t,i,n,o=e.peak;o=mapToLevelDisplay(o),49.5>o?(t=o,i=0,n=0):58.8>o?(t=49.5,i=o-49.5,n=0):(t=49.5,i=9.3,n=o-58.8);let l=document.getElementById(e.displayID+"LevelGreen");l.style.height=t+"%",l=document.getElementById(e.displayID+"LevelOrange"),l.style.height=i+"%",l=document.getElementById(e.displayID+"LevelRed"),l.style.height=n+"%"}function setThresholdPos(e){let t=e.threshold;0<t&&.011>t&&(t=.011),t=mapToLevelDisplay(t);let i=document.getElementById(e.displayID+"Threshold");i.style.height=t+"%"}function setSliderPos(e){let t,i=e.gain;t=1>i?34*i+8:2.5*i+39.5;let n=document.getElementById(e.displayID+"Slider");n.style.bottom=t+"%"}function createChannelUI(e){let t="ID"+e.channel,i=" <div id=\""+t+"\" style=\"position:relative;width:100px; height:100%; display: inline-block\"> \t\t\t<img style=\"position:relative;bottom:0%; right:0%; width:100%; height:99%;\" src=\"images/controlBG.png\">  \t\t\t<img style=\"position:absolute;bottom:8%; right:5%; width:40%; height:10%;\" src=\"images/slider.png\" id=\""+t+"Slider\" >  \t\t\t<div style=\"position:absolute;bottom:8%; right:5%; width:90%; height:65%;\" draggable=\"false\" id=\""+t+"SlideBtn\" \t\t\t\tonmousedown=\"sliderDragStart(event)\" onmousemove=\"sliderDrag(event)\" onmouseup=\"sliderDragStop(event)\" \t\t\t\tontouchstart=\"sliderDragStart(event)\" ontouchmove=\"sliderDrag(event)\" ontouchend=\"sliderDragStop(event)\"></div>  \t\t\t<div style=\"position:absolute;bottom:8%; left:25%; width:5%; height:0%; background-color:#66FF33\" id=\""+t+"LevelGreen\"></div> \t\t\t<div style=\"position:absolute;bottom:57.5%; left:25%; width:5%; height:0%; background-color:#FF6600\" id=\""+t+"LevelOrange\"></div> \t\t\t<div style=\"position:absolute;bottom:66.8%; left:25%; width:5%; height:0%; background-color:#FF0000\" id=\""+t+"LevelRed\"></div> \t\t\t<div style=\"position:absolute;bottom:8%; left:25%; width:5%; height:0%; background-color:#999999\" id=\""+t+"Threshold\"></div> \t\t\t<img style=\"position:absolute;right:30%; top:10%;width:40%; padding-bottom:10%;\" src=\"images/channelOff.png\" id=\""+t+"Off\" onclick=\"unmuteButton(event)\">  \t\t\t<img style=\"position:absolute;right:30%; top:10%;width:40%; padding-bottom:10%;\" src=\"images/channelOn.png\" id=\""+t+"On\" onclick=\"muteButton(event)\">  \t\t\t<img style=\"position:absolute;right:30%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/AGCOff.png\" id=\""+t+"AGCOff\" onclick=\"agcButton(event)\">  \t\t\t<img style=\"position:absolute;right:30%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/AGCOn.png\" id=\""+t+"AGCOn\" onclick=\"agcButton(event)\">  \t\t\t<div style=\"position:absolute;top:1%; left:3%; width:90%; height:10%;color:#AAAAAA; font-size: 3vmin\" id=\""+t+"Name\"> \t\t\t\t<marquee behavior=\"slide\" direction=\"left\">"+e.name+"</marquee> \t\t\t</div> \t\t</div>",n=document.getElementById("mixerRack");n.innerHTML+=i,e.displayID=t}function createOutputUI(e){let t="ID"+e.channel,i=" <div id=\""+t+"\" style=\"position:relative;width:100px; height:100%; display: inline-block\"> \t\t\t<img style=\"position:relative;bottom:0%; right:0%; width:100%; height:99%;\" src=\"images/controlBG.png\">  \t\t\t<img style=\"position:absolute;bottom:8%; right:5%; width:40%; height:10%;\" src=\"images/slider.png\" id=\""+t+"Slider\" >  \t\t\t<div style=\"position:absolute;bottom:8%; right:5%; width:90%; height:65%;\" draggable=\"false\" id=\""+t+"SlideBtn\" \t\t\t\tonmousedown=\"sliderDragStart(event)\" onmousemove=\"sliderDrag(event)\" onmouseup=\"sliderDragStop(event)\" \t\t\t\tontouchstart=\"sliderDragStart(event)\" ontouchmove=\"sliderDrag(event)\" ontouchend=\"sliderDragStop(event)\"></div>  \t\t\t<div style=\"position:absolute;bottom:8%; left:25%; width:5%; height:0%; background-color:#66FF33\" id=\""+t+"LevelGreen\"></div> \t\t\t<div style=\"position:absolute;bottom:57.5%; left:25%; width:5%; height:0%; background-color:#FF6600\" id=\""+t+"LevelOrange\"></div> \t\t\t<div style=\"position:absolute;bottom:66.8%; left:25%; width:5%; height:0%; background-color:#FF0000\" id=\""+t+"LevelRed\"></div> \t\t\t<div style=\"position:absolute;bottom:8%; left:25%; width:5%; height:0%; background-color:#999999\" id=\""+t+"Threshold\"></div> \t\t\t<img style=\"position:absolute;right:5%; top:9%;width:80%; padding-bottom:10%;object-fit: scale-down;visibility: hidden\" src=\"images/live.png\" id=\""+t+"live\" >  \t\t\t<img style=\"position:absolute;right:30%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/AGCOff.png\" id=\""+t+"AGCOff\" onclick=\"agcButton(event)\">  \t\t\t<img style=\"position:absolute;right:30%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/AGCOn.png\" id=\""+t+"AGCOn\" onclick=\"agcButton(event)\">  \t\t\t<div style=\"position:absolute;top:1%; left:3%; width:90%; height:10%;color:#AAAAAA;font-size: 3vmin\" id=\""+t+"Name\"> \t\t\t\t<marquee behavior=\"slide\" direction=\"left\">"+e.name+"</marquee> \t\t\t</div> \t\t</div>",n=document.getElementById("mixerRack");n.innerHTML+=i,e.displayID=t}function createMicUI(e){let t="ID"+e.channel,i=" <div id=\""+t+"\" style=\"position:relative;width:100px; height:100%; display: inline-block\"> \t\t\t<img style=\"position:relative;bottom:0%; right:0%; width:100%; height:99%;\" src=\"images/controlBG.png\">  \t\t\t<img style=\"position:absolute;bottom:8%; right:5%; width:40%; height:10%;\" src=\"images/slider.png\" id=\""+t+"Slider\" >  \t\t\t<div style=\"position:absolute;bottom:8%; right:5%; width:90%; height:65%;\" draggable=\"false\" id=\""+t+"SlideBtn\" \t\t\t\tonmousedown=\"sliderDragStart(event)\" onmousemove=\"sliderDrag(event)\" onmouseup=\"sliderDragStop(event)\" \t\t\t\tontouchstart=\"sliderDragStart(event)\" ontouchmove=\"sliderDrag(event)\" ontouchend=\"sliderDragStop(event)\"></div>  \t\t\t<div style=\"position:absolute;bottom:8%; left:25%; width:5%; height:0%; background-color:#66FF33\" id=\""+t+"LevelGreen\"></div> \t\t\t<div style=\"position:absolute;bottom:57.5%; left:25%; width:5%; height:0%; background-color:#FF6600\" id=\""+t+"LevelOrange\"></div> \t\t\t<div style=\"position:absolute;bottom:66.8%; left:25%; width:5%; height:0%; background-color:#FF0000\" id=\""+t+"LevelRed\"></div> \t\t\t<div style=\"position:absolute;bottom:8%; left:25%; width:5%; height:0%; background-color:#999999\" id=\""+t+"Threshold\"></div> \t\t\t<img style=\"position:absolute;right:5%; top:10%;width:40%; padding-bottom:10%;\" src=\"images/channelOff.png\" id=\""+t+"Off\" onclick=\"unmuteButton(event)\">  \t\t\t<img style=\"position:absolute;right:5%; top:10%;width:40%; padding-bottom:10%;\" src=\"images/channelOn.png\" id=\""+t+"On\" onclick=\"muteButton(event)\">  \t\t\t<img style=\"position:absolute;left:5%; top:10%;width:40%; padding-bottom:10%;\" src=\"images/StereoOff.png\" id=\""+t+"stereoOff\" onclick=\"stereoOnOff(event)\">  \t\t\t<img style=\"position:absolute;left:5%; top:10%;width:40%; padding-bottom:10%;\" src=\"images/StereoOn.png\" id=\""+t+"stereoOn\" onclick=\"stereoOnOff(event)\">  \t\t\t<img style=\"position:absolute;right:5%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/AGCOff.png\" id=\""+t+"AGCOff\" onclick=\"agcButton(event)\">  \t\t\t<img style=\"position:absolute;right:5%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/AGCOn.png\" id=\""+t+"AGCOn\" onclick=\"agcButton(event)\">  \t\t\t<img style=\"position:absolute;left:5%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/HQOff.png\" id=\""+t+"HQOff\" onclick=\"HQOnOff(event)\">  \t\t\t<img style=\"position:absolute;left:5%; bottom:1%;width:40%; padding-bottom:10%;\" src=\"images/HQOn.png\" id=\""+t+"HQOn\" onclick=\"HQOnOff(event)\">  \t\t\t<div style=\"position:absolute;top:1%; left:3%; width:90%; height:10%;color:#AAAAAA; font-size: 3vmin\" id=\""+t+"Name\"> \t\t\t\t<marquee behavior=\"slide\" direction=\"left\">"+e.name+"</marquee> \t\t\t</div> \t\t</div>",n=document.getElementById("mixerRack");n.innerHTML+=i,e.displayID=t}function removeChannelUI(e){trace2("Removing channel ",e.name);let t=document.getElementById(e.displayID);null!=t&&t.remove(),e.displayID=void 0,e.name="",e.gain=1,e.agc=!0,e.muted=!1,e.peak=0,e.seq=0}function convertIdToObj(id){return id=id.substring(2),parseFloat(id)&&(id=parseFloat(id)),id="number"==typeof id||"0"==id?channels[id]:eval(id),id}function recButton(){trace2("rec");let e=event.target.parentNode.id,t=document.getElementById(e+"talkOn");t.style.visibility="hidden",e=convertIdToObj(e),recording=!0}function muteButton(){let e=event.target.parentNode.id,t=document.getElementById(e+"On");t.style.visibility="hidden",e=convertIdToObj(e),e.muted=!0}function unmuteButton(){let e=event.target.parentNode.id,t=document.getElementById(e+"On");t.style.visibility="inherit",e=convertIdToObj(e),e.muted=!1}function agcButton(){let e=event.target.parentNode.id,t=convertIdToObj(e),i=document.getElementById(e+"AGCOn");i.style.visibility=t.agc?"hidden":"inherit",t.agc=!t.agc}function stereoOnOff(){let e=event.target.parentNode.id,t=document.getElementById(e+"stereoOn");stereoOn?(t.style.visibility="hidden",stereoOn=!1):(t.style.visibility="inherit",stereoOn=!0)}function HQOnOff(){let e=event.target.parentNode.id,t=document.getElementById(e+"HQOn");HQOn?(t.style.visibility="hidden",HQOn=!1):(t.style.visibility="inherit",HQOn=!0)}var slider={dragging:!1,dragStartY:0,dragStartPct:0};function sliderDragStart(e){slider.dragging=!0,e.target.style.cursor="pointer",slider.dragStartY=e.clientY,isNaN(slider.dragStartY)&&(slider.dragStartY=e.touches[0].clientY);let t=e.target.parentNode.id,i=document.getElementById(t+"Slider");slider.dragStartPct=parseFloat(i.style.bottom)}function sliderDrag(e){if(slider.dragging){let t=e.clientY;isNaN(t)&&(t=e.touches[0].clientY),t=slider.dragStartY-t;let i=100*(.65*(t/e.target.clientHeight));p=slider.dragStartPct+i;let n=e.target.parentNode.id,l=document.getElementById(n+"Slider");8>p&&(p=8),65<p&&(p=65),l.style.bottom=p;let o=document.getElementById(n+"AGCOn");o.style.visibility="hidden";let a;a=42>p?(p-8)/34:(p-39.5)/2.5,n=convertIdToObj(n),n.gain=a,n.agc=!1}}function sliderDragStop(e){e.target.style.cursor="default",slider.dragging=!1}function setStatusLED(e,t){let i=document.getElementById(e);i.className="Red"==t?"redLED":"Orange"==t?"orangeLED":"greenLED"}function maxValue(e){let t,n=0;for(let o=0;o<e.length;o++)t=Math.abs(e[o]),t>n&&(n=t);return n}function avgValue(e){let n=0;for(let t=0;t<e.length;t++)n+=Math.abs(e[t]);return n/e.length}function applyAutoGain(e,t){let n,o,l,a,s,d=t.gain,r=t.targetGain,g=t.ceiling,h=-1*g,u=t.gainRate,m=t.agc;m||(r=d),o=maxValue(e),l=g/o,o=0,l>r?l=r:trace2("Clipping gain"),l>=d?(s=e.length,m&&(l=d+(l-d)/u)):(s=Math.floor(e.length/10),trace2("Gain dropping")),n=d;for(let r=0;r<s;r++)a=r/s,n=d+(l-d)*a,e[r]*=n,e[r]>=g?e[r]=g:e[r]<=h&&(e[r]=h),a=Math.abs(e[r]),a>o&&(o=a);if(s!=e.length){n=l;for(let t=s;t<e.length;t++)e[t]*=n,e[t]>=g?e[t]=g:e[t]<=h&&(e[t]=h),a=Math.abs(e[t]),a>o&&(o=a)}return 1!=g&&(l=d),{finalGain:l,peak:o}}function applyGain(e,t){for(let n=0;n<e.length;n++)e[n]*=t}function fadeUp(e){for(let t=0;t<e.length;t++)e[t]*=t/e.length}function fadeDown(e){for(let t=0;t<e.length;t++)e[t]*=(e.length-t)/e.length}var talkoverLevel=.01;-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&(talkoverLevel=1);var talkoverLag=50,talkoverTimer=0;function talkover(){let e=new Date().getTime();talkoverTimer=e+talkoverLag,mixOut.ceiling=talkoverLevel}function endTalkover(){let e=new Date().getTime();e>talkoverTimer&&(mixOut.ceiling=1)}var thresholdBands=[1e-4,2e-4,3e-4,5e-4,7e-4,.001,.002,.003,.005,.007,.01,.02,.03,.05,.07,.1,.2,.3,.5,.7,1,2],levelCategories=Array(thresholdBands.length).fill(0);function levelClassifier(e){for(let t=0;t<thresholdBands.length;t++)if(e<thresholdBands[t]){levelCategories[t]++;break}}var noiseThreshold=.02;function setNoiseThreshold(){let e=0;for(let t=0;14>t;t++)levelCategories[t]>e&&(e=levelCategories[t],noiseThreshold=thresholdBands[t]);if(noiseThreshold*=1.2,trace2("Noise threshold: ",noiseThreshold),0<e)for(let t=0;14>t;t++)levelCategories[t]=100*(levelCategories[t]/e)}var thresholdBuffer=Array(20).fill(0),gateDelay=30;function processAudio(t){enterState(audioInOutState);var e=t.inputBuffer.getChannelData(0),i=t.inputBuffer.getChannelData(1),n=t.outputBuffer.getChannelData(0),o=t.outputBuffer.getChannelData(1),l=t.outputBuffer.getChannelData(2);if(!0==echoTest.running){let t=runEchoTest(e);for(let e in t)n[e]=t[e],o[e]=t[e];return void enterState(idleState)}if(socketConnected){let t=[],n=[],o=maxValue(e);if(pauseTracing||levelClassifier(o),o>micIn.threshold&&o>noiseThreshold&&(0==micIn.gate?micIn.gate=gateDelay+1:micIn.gate=gateDelay),performer&&(micIn.gate=1),0<micIn.gate?(t=e,n=i,micIn.gate--):(t=Array(e.length).fill(0),n=Array(e.length).fill(0)),micBufferL.push(...t),micBufferR.push(...n),micBufferL.length>micAudioPacketSize){let e=micBufferL.splice(0,micAudioPacketSize),t=micBufferR.splice(0,micAudioPacketSize),n={mono8:[],mono16:[]},o=!1,l=0;if(!performer){let t=[],o=[];n=reSample(e,soundcardSampleRate,SampleRate,downCache,PacketSize);let s=applyAutoGain(n,micIn);if(s.peak>micIn.peak&&(micIn.peak=s.peak),l=s.peak,micIn.gain=s.finalGain,0==l||micIn.muted||serverMuted)l=0;else{let e,l,a=0;for(let s=0;s<n.length;s+=2)e=(n[s]+n[s+1])/2,l=(n[s]-n[s+1])/2,t[a]=e,o[a]=l,a++}n={mono8:t,mono16:o,mono32:[],stereo8:[],stereo16:[],stereo32:[]};let d=zipson.stringify(n);n=zipson.parse(d)}else if(!micIn.muted){let i=prepPerfAudio(e,t);o=zipson.stringify(i)}else o=zipson.stringify({mono8:[],mono16:[],mono32:[],stereo8:[],stereo16:[],stereo32:[]});let a=performer?PerfSampleRate:SampleRate,i=new Date().getTime(),s={name:myName,audio:n,perfAudio:o,liveClients:1,sequence:packetSequence,timestamp:i,peak:l,channel:myChannel,recording:recording,sampleRate:a,group:myGroup,rtt:rtt1};socketIO.emit("u",s);let d=JSON.stringify(s).length/1024;bytesSent+=d,performer||packetBuf.push(s),packetsOut++,packetSequence++}}let a=[],s=[];if(spkrBufferL.length>ChunkSize)a=spkrBufferL.splice(0,ChunkSize),s=spkrBufferR.splice(0,ChunkSize);else{a=spkrBufferL.splice(0,spkrBufferL.length),s=spkrBufferR.splice(0,spkrBufferR.length);let e=Array(ChunkSize-spkrBufferL.length).fill(0);a.push(...e),s.push(...e),shortages++}for(let e in n)n[e]=a[e],o[e]=s[e];let d=[];if(venueBuffer.length>ChunkSize)d=venueBuffer.splice(0,ChunkSize);else{d=venueBuffer.splice(0,venueBuffer.length);let e=Array(ChunkSize-venueBuffer.length).fill(0);d.push(...e)}for(let e in l)l[e]=d[e];let r=maxValue(a),g=maxValue(s),h=maxValue(d);r<g&&(r=g),r<h&&(r=h),thresholdBuffer.unshift(r),micIn.threshold=maxValue([thresholdBuffer[echoTest.sampleDelay-2],thresholdBuffer[echoTest.sampleDelay-1],thresholdBuffer[echoTest.sampleDelay],thresholdBuffer[echoTest.sampleDelay+1],thresholdBuffer[echoTest.sampleDelay+2]])*echoTest.factor*mixOut.gain,thresholdBuffer.pop(),enterState(idleState)}function prepPerfAudio(e,t){let n=!1;if(stereoOn)for(let o=0;o<e.length;o++)e[o]!=t[o]&&(n=!0);e=reSample(e,soundcardSampleRate,PerfSampleRate,downCachePerfL,PerfPacketSize),n&&(t=reSample(t,soundcardSampleRate,PerfSampleRate,downCachePerfR,PerfPacketSize));let o;if(n){let i=maxValue(e),n=maxValue(t);i>n?(o=applyAutoGain(e,micIn),applyGain(t,o.finalGain)):(o=applyAutoGain(t,micIn),applyGain(e,o.finalGain))}else o=applyAutoGain(e,micIn);o.peak>micIn.peak&&(micIn.peak=o.peak),micIn.gain=o.finalGain;let l=[],a=[];if(n)for(let n=0;n<e.length;n++)l[n]=e[n]+t[n],a[n]=e[n]-t[n];else l=e;let s=[],d=[],r=[],g=[],h=[],u=[],m=0,y=0;for(let n=0;n<l.length;n+=4){let e,t,i,o,a,g;e=(l[n]+l[n+1])/2,i=(l[n]-l[n+1])/2,t=(l[n+2]+l[n+3])/2,o=(l[n+2]-l[n+3])/2,a=(e+t)/2,g=(e-t)/2,s[m]=a,d[m]=g,m++,r[y]=i,y++,r[y]=o,y++}if(m=0,y=0,n)for(let e=0;e<a.length;e+=4){let t,i,n,o,l,s;t=(a[e]+a[e+1])/2,n=(a[e]-a[e+1])/2,i=(a[e+2]+a[e+3])/2,o=(a[e+2]-a[e+3])/2,l=(t+i)/2,s=(t-i)/2,g[m]=l,h[m]=s,m++,u[y]=n,y++,u[y]=o,y++}HQOn||(r=[],u=[]);let i={mono8:s,mono16:d,mono32:r,stereo8:g,stereo16:h,stereo32:u};return i}var micFilter1,micFilter2,context,reverb,reverbFile="";function handleAudio(e){let t=window.AudioContext||window.webkitAudioContext||!1;t?context=new t:alert("Sorry, the Web Audio API is not supported by your browser. Consider upgrading or using Google Chrome or Mozilla Firefox"),soundcardSampleRate=context.sampleRate,micAudioPacketSize=Math.round(PacketSize*soundcardSampleRate/SampleRate),tracef("Sample rate is ",soundcardSampleRate," mic audio per packet is ",micAudioPacketSize," rounded from",soundcardSampleRate/(SampleRate/PacketSize)),micAccessAllowed=!0,createOutputUI(mixOut),createMicUI(micIn),createChannelUI(venue);let i,n=context.createMediaStreamSource(e);i=context.createScriptProcessor?context.createScriptProcessor(ChunkSize,2,3):context.createJavaScriptNode(ChunkSize,2,3),i.onaudioprocess=processAudio,micFilter1=context.createBiquadFilter(),micFilter1.type="lowpass",micFilter1.frequency.value=HighFilterFreq,micFilter1.Q.value=1,micFilter2=context.createBiquadFilter(),micFilter2.type="highpass",micFilter2.frequency.value=LowFilterFreq,micFilter2.Q.value=1,reverb=context.createConvolver(),reverb.buffer=impulseResponse(1,8);let o=context.createChannelSplitter(),l=context.createChannelMerger(),a=context.createChannelMerger(),s=context.createChannelMerger(),d=context.createDelay(),r=context.createDelay(),g=context.createDelay(),h=context.createDelay();d.delayTime.value=3e-4,r.delayTime.value=3e-4,g.delayTime.value=.019,h.delayTime.value=.033,n.connect(micFilter1),micFilter1.connect(micFilter2),micFilter2.connect(i),i.connect(o),o.connect(l,0,0),o.connect(l,1,1),l.connect(context.destination),o.connect(reverb,2),reverb.connect(context.destination),startEchoTest()}function loadVenueReverb(e){if(e==reverbFile)return;if(""==e)return void(reverb.buffer=impulseResponse(1,8));let t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onreadystatechange=function(){4==this.readyState&&200==this.status&&context.decodeAudioData(t.response,function(t){reverb.buffer=t,reverbFile=e,console.log(e," loaded into reverb")})},t.send(),console.log("Requested to load ",e)}function impulseResponse(e,t){let n=soundcardSampleRate*e,o=context.createBuffer(2,n,soundcardSampleRate),l=o.getChannelData(0),a=o.getChannelData(1);t||(t=2);let s,d,r,g,h,u,m;s=d=r=g=h=u=m=0;for(let o=0;o<n;o++){let e,i=2*Math.random()-1;s=.99886*s+.0555179*i,d=.99332*d+.0750759*i,r=.969*r+.153852*i,g=.8665*g+.3104856*i,h=.55*h+.5329522*i,u=-.7616*u-.016898*i,e=s+d+r+g+h+u+m+.5362*i,e*=.11,m=.115926*i;let y=(2*Math.random()-1)*Math.pow(1-o/n,t);l[o]=y*Math.random(),a[o]=y*Math.random()}return o}document.addEventListener("DOMContentLoaded",function(){initAudio()});function initAudio(){let e={mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1},optional:[]};navigator.getUM=navigator.getUserMedia||navigator.webKitGetUserMedia||navigator.moxGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.mediaDevices.getUserMedia?(trace("Using GUM with promise"),navigator.mediaDevices.getUserMedia({audio:e}).then(function(e){handleAudio(e)}).catch(function(t){trace(t.name+": "+t.message)})):(trace("Using OLD GUM"),navigator.getUM({audio:e},function(e){handleAudio(e)},function(){trace("Audio HW is not accessible.")}))}var downCache=[0,0],vCache=[0,0],gLCache=[0,0],gRCache=[0,0],downCachePerfL=[0,0],downCachePerfR=[0,0],upCachePerfM=[0,0],upCachePerfS=[0,0];function reSample(e,t,i,n,o){null==o&&(o=Math.floor(e.length*i/t));let l=e.length/o,a=Array(o).fill(0);for(let s=0;s<o-1;s++){let t=l-1+s*l,i=Math.round(t);for(let o,l=-1;2>l;l++)o=e[i+l],isNaN(o)&&(o=n[1+l]),isNaN(o)&&(o=e[i]),a[s]+=o*magicKernel(t-i-l)}return n[0]=e[e.length-2],n[1]=a[o-1]=e[e.length-1],a}function magicKernel(e){if(-.5>e)return .5*(e+1.5)*(e+1.5);return .5<e?.5*(e-1.5)*(e-1.5):.75-e*e}var echoTest={running:!1,steps:[16,8,128,64,32,1,.5,.2,.1,.05,.02,0],currentStep:0,analysisStep:0,tones:[],samplesNeeded:0,results:[],delays:[],delay:129,factor:2,sampleDelay:6};echoTest.steps.forEach(e=>{if(1<e){let t=[];for(let i=0;i<ChunkSize;i++)t.push(Math.sin(Math.PI*i/(ChunkSize/(2*e))));echoTest.tones[e]=t}else if(0<e){let t=[];for(let i=0;i<ChunkSize;i++)t.push(e*Math.sin(Math.PI*i/(ChunkSize/64)));echoTest.tones[e]=t}});function startEchoTest(){!1==echoTest.running&&(trace2("Starting echo test"),echoTest.running=!0,echoTest.currentStep=0,echoTest.analysisStep=0,echoTest.results=[],echoTest.delays=[])}function runEchoTest(e){let t,i=echoTest.steps[echoTest.currentStep];if(0<i)0==echoTest.samplesNeeded?(trace2("Running test ",i),t=echoTest.tones[i],echoTest.results[i]=[],echoTest.samplesNeeded=10):(echoTest.results[i].push(...e),t=Array(ChunkSize).fill(0),echoTest.samplesNeeded--,0==echoTest.samplesNeeded&&echoTest.currentStep++);else{let e=echoTest.steps[echoTest.analysisStep];if(0<e){let t=echoTest.results[e];trace2("Analyzing ","test "+e);let i=echoTest.tones[e],n=i.length,o=[];for(let e,l=0;l<t.length-n;l++){e=0;for(let o=0;o<n;o++)e+=t[l+o]*i[o];o.push(e)}let l=0,a=0;for(let e=0;e<o.length;e++)o[e]>l&&(l=o[e],a=e);let s=10*Math.round(100*a/soundcardSampleRate);trace2("Pulse delay is ",s,"mS"),echoTest.delays.push(s.toFixed(0))}else{trace2("Reviewing results");let e=[];echoTest.delays.forEach(t=>{null==e[t]?e[t]=1:e[t]++});let t=0,i=!1;for(let n in e)e[n]>t&&(t=e[n]),0<n&&5<e[n]&&(trace2("Delay is ",n),i=!0,echoTest.delay=n,echoTest.sampleDelay=Math.ceil(echoTest.delay*soundcardSampleRate/1e3/1024),trace2("Sample delay is ",echoTest.sampleDelay));if(i){let e=Math.round(echoTest.delay*soundcardSampleRate/1e3),n=[];for(let o,t=0;t<echoTest.steps.length-1;t++)if(o=echoTest.steps[t],1>=o){let i=echoTest.results[o].slice(e,e+1024),l=avgValue(i),a=l/(.637*o);trace2("Test ",echoTest.steps[t]," Factor: ",a),n.push(a)}echoTest.factor=3*avgValue(n),echoTest.factor=2,trace2("Forced factor is ",echoTest.factor)}else trace2("No clear result"),3<t&&trace2("It may be worth repeating the test");echoTest.running=!1}echoTest.analysisStep++}return t}function drawWave(e,t,i){let n="<div id=\""+t+"\" style=\"position:absolute; bottom:10%; right:5%; width:80%; height:80%; background-color: #222222; visibility: hidden\">"+t,o=0;for(let n=0;n<e.length;n++)e[n]=Math.abs(e[n]),e[n]>o&&(o=e[n]);for(let o=4;o<e.length-4;o++){let t=100*o/e.length,i=50+50*e[o];n+="<div style=\"position:absolute; bottom:"+i+"%;left:"+t+"%;width:1px;height:1px;background-color:#66FF33\"></div>"}o=50+50*o,n+="<div style=\"position:absolute; bottom:"+o+"%;left:0%;width:100%;height:1px;background-color:#FF0000\">"+o+"</div>",n+="<div style=\"position:absolute; bottom:0%;left:"+i+"%;width:1px;height:100%;background-color:#FF0000\"></div>",n+="</div>";let l=document.getElementById("graphs");l.innerHTML+=n,monitors.push(t)}var currentMonitor=0,monitors=["none","monitor","monitor2"];document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("monitorBtn");e.onclick=function(){if("none"!=monitors[currentMonitor]){let e=document.getElementById(monitors[currentMonitor]);e.style.visibility="hidden",e.parentNode.style.visibility="hidden"}if(currentMonitor++,currentMonitor==monitors.length&&(currentMonitor=0),"none"!=monitors[currentMonitor]){let e=document.getElementById(monitors[currentMonitor]);e.style.visibility="visible",e.parentNode.style.visibility="visible"}};let t=document.getElementById("settingsBtn");t.onclick=function(){trace2("Settings Button Pressed"),toggleSettings()};let i=document.getElementById("testBtn");i.onclick=function(){trace2("Echo Test Button Pressed"),startEchoTest()};let n=document.getElementById("actionBtn");n.onclick=function(){trace("Pause traces pressed"),pauseTracing=!0!=pauseTracing}});var pauseTracing=!0,packetsIn=0,packetsOut=0,bytesSent=0,bytesRcvd=0,overflows=0,shortages=0,packetSequence=0,tracecount=0,sendShortages=0;function printReport(){enterState(UIState);let e=.1<(rtt1-rtt5)/rtt5&&400<rtt5?"UNSTABLE":"stable";pauseTracing||(trace("Idle=",idleState.total," data in=",dataInState.total," audio in/out=",audioInOutState.total," UI work=",UIState.total),trace("Sent=",packetsOut," Heard=",packetsIn," overflows=",overflows," shortages=",shortages," RTT=",rtt.toFixed(1)," RTT1=",rtt1.toFixed(1)," RTT5=",rtt5.toFixed(1)," State=",e," audience=",audience," bytes Out=",bytesSent.toFixed(1)," bytes In=",bytesRcvd.toFixed(1)),trace(" micIn.peak:",micIn.peak.toFixed(1)," mixOut.peak:",mixOut.peak.toFixed(1)," speaker buff:",spkrBufferL.length," Max Buff:",maxBuffSize),trace2("bytes Out=",bytesSent.toFixed(1)," bytes In=",bytesRcvd.toFixed(1))),!0==performer?(document.getElementById("onair").style.visibility="visible",micFilter1.frequency.value=PerfSampleRate/2.2,micFilter2.frequency.value=30):(document.getElementById("onair").style.visibility="hidden",micFilter1.frequency.value=HighFilterFreq,micFilter2.frequency.value=LowFilterFreq,document.getElementById("live").style.visibility=liveShow?"visible":"hidden"),document.getElementById("ID"+mixOut.channel+"live").style.visibility=liveShow?"inherit":"hidden";let t="Green";(1<overflows||1<shortages||"stable"!=e)&&(t="Orange"),!1==socketConnected&&(t="Red"),setStatusLED("GeneralStatus",t);let i=1.2*(SampleRate/PacketSize),n=.8*(SampleRate/PacketSize),o="Green";(packetsOut<n||packetsOut>i)&&(o="Orange"),packetsOut<n/3&&(o="Red"),setStatusLED("UpStatus",o);let l="Green";(packetsIn<n||packetsIn>i)&&(l="Orange"),packetsIn<n/3&&(l="Red"),setStatusLED("DownStatus",l),(2<overflows||2<shortages)&&2e4>maxBuffSize&&(maxBuffSize+=100),6e3<maxBuffSize&&(maxBuffSize-=20),packetsIn=0,packetsOut=0,bytesSent=0,bytesRcvd=0,overflows=0,shortages=0,rtt=0,tracecount=1,enterState(idleState)}setInterval(printReport,1e3);var traceDiv=null,traceDiv2=null,traceArray=[],traceArray2=[],maxTraces=100;document.addEventListener("DOMContentLoaded",function(){traceDiv=document.getElementById("Trace"),traceDiv2=document.getElementById("Trace2")});function trace(){if(!1==pauseTracing){let e="";for(let t=0;t<arguments.length;t++)e+=arguments[t];console.log(e),traceArray.push(e+"<br>"),traceArray.length>maxTraces&&traceArray.shift(0,1),null!=traceDiv&&(traceDiv.innerHTML=traceArray.join(""),traceDiv.scrollTop=traceDiv.scrollHeight)}}function tracef(){let e="";for(let t=0;t<arguments.length;t++)e+=arguments[t];console.log(e),traceArray.push(e+"<br>"),traceArray.length>maxTraces&&traceArray.shift(0,1),null!=traceDiv&&(traceDiv.innerHTML=traceArray.join(""),traceDiv.scrollTop=traceDiv.scrollHeight)}function trace2(){if(!1==pauseTracing){let e="";for(let t=0;t<arguments.length;t++)e+=arguments[t];console.log(e),traceArray2.push(e+"<br>"),traceArray2.length>maxTraces&&traceArray2.shift(0,1),null!=traceDiv2&&(traceDiv2.innerHTML=traceArray2.join(""),traceDiv2.scrollTop=traceDiv2.scrollHeight)}}function stateTimer(){this.name="",this.total=0,this.start=0}var idleState=new stateTimer;idleState.name="Idle";var dataInState=new stateTimer;dataInState.name="Data In";var audioInOutState=new stateTimer;audioInOutState.name="Audio In/Out";var UIState=new stateTimer;UIState.name="UI updating";var currentState=idleState;currentState.start=new Date().getTime();function enterState(e){let t=new Date().getTime();currentState.total+=t-currentState.start,e.start=t,currentState=e}window.addEventListener("load",function(){deriveTree()});function deriveTree(){let e=document.getElementById("venue");if(null==e)return;e=e.contentDocument;let t=e.getElementsByClassName("selectable");t=e.getElementsByTagName("rect");for(var n=0,o=t.length;n<o;++n){let e=t[n];if(1==e.nodeType)switch(e.nodeName){case"circle":break;case"rect":let t=parseFloat(e.getAttributeNS(null,"x")),i=parseFloat(e.getAttributeNS(null,"y")),n=parseFloat(e.getAttributeNS(null,"width")),o=parseFloat(e.getAttributeNS(null,"height")),l=e.getAttributeNS(null,"id");console.log("Found a rectangle"),console.log(t,i,n,o,l);}}}enterState(idleState),trace("Starting V3.1");